<?php
// Simple admin creation script. After creating the admin, delete this file for security.
include 'config.php';

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $email = trim($_POST['email'] ?? '');
    $password = trim($_POST['password'] ?? '');

    if (empty($email) || empty($password)) {
        $error = 'Email and password required.';
    } else {
        $hash = password_hash($password, PASSWORD_DEFAULT);
        $stmt = $conn->prepare('INSERT INTO core (email, password) VALUES (?, ?)');
        if (!$stmt) {
            $error = 'Prepare failed: ' . $conn->error;
        } else {
            $stmt->bind_param('ss', $email, $hash);
            if ($stmt->execute()) {
                $success = 'Admin created successfully. Please delete create_admin.php now for security.';
            } else {
                $error = 'Execute failed: ' . $stmt->error;
            }
            $stmt->close();
        }
    }
}
?>
<!doctype html>
<html>
<head><meta charset="utf-8"><title>Create Admin</title></head>
<body>
<h2>Create admin user</h2>
<?php if(!empty($error)) echo '<p style="color:red;">'.htmlspecialchars($error).'</p>'; ?>
<?php if(!empty($success)) echo '<p style="color:green;">'.htmlspecialchars($success).'</p>'; ?>
<form method="post">
    <label>Email: <input type="email" name="email" required></label><br><br>
    <label>Password: <input type="password" name="password" required></label><br><br>
    <button type="submit">Create Admin</button>
</form>
</body>
</html>
